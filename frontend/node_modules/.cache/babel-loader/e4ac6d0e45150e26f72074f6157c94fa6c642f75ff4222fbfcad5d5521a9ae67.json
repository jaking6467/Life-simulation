{"ast":null,"code":"// src/services/socket.js\nimport { io } from 'socket.io-client';\nconst SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:3001';\nclass SocketService {\n  constructor() {\n    this.socket = null;\n    this.listeners = new Map();\n  }\n  connect() {\n    var _this$socket;\n    if ((_this$socket = this.socket) !== null && _this$socket !== void 0 && _this$socket.connected) return;\n    this.socket = io(SOCKET_URL, {\n      transports: ['websocket'],\n      reconnection: true,\n      reconnectionDelay: 1000,\n      reconnectionAttempts: 5\n    });\n    this.socket.on('connect', () => {\n      console.log('✅ Connected to server');\n    });\n    this.socket.on('disconnect', () => {\n      console.log('❌ Disconnected from server');\n    });\n    this.socket.on('error', error => {\n      console.error('Socket error:', error);\n    });\n    return this.socket;\n  }\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n    }\n  }\n  emit(event, data) {\n    if (this.socket) {\n      this.socket.emit(event, data);\n    }\n  }\n  on(event, callback) {\n    if (this.socket) {\n      this.socket.on(event, callback);\n\n      // เก็บ listener ไว้\n      if (!this.listeners.has(event)) {\n        this.listeners.set(event, []);\n      }\n      this.listeners.get(event).push(callback);\n    }\n  }\n  off(event, callback) {\n    if (this.socket) {\n      this.socket.off(event, callback);\n\n      // ลบ listener\n      if (this.listeners.has(event)) {\n        const callbacks = this.listeners.get(event);\n        const index = callbacks.indexOf(callback);\n        if (index > -1) {\n          callbacks.splice(index, 1);\n        }\n      }\n    }\n  }\n  removeAllListeners(event) {\n    if (this.socket) {\n      this.socket.removeAllListeners(event);\n      this.listeners.delete(event);\n    }\n  }\n\n  // Game Actions\n  register(username) {\n    this.emit('register', {\n      username\n    });\n  }\n  findGame() {\n    this.emit('findGame');\n  }\n  cancelSearch() {\n    this.emit('cancelSearch');\n  }\n  createRoom(maxPlayers = 4) {\n    this.emit('createRoom', {\n      maxPlayers\n    });\n  }\n  joinRoom(lobbyId) {\n    this.emit('joinRoom', {\n      lobbyId\n    });\n  }\n  ready() {\n    this.emit('ready');\n  }\n  selectAction(action) {\n    this.emit('selectAction', {\n      action\n    });\n  }\n  leaveRoom() {\n    this.emit('leaveRoom');\n  }\n}\nexport default new SocketService();","map":{"version":3,"names":["io","SOCKET_URL","process","env","REACT_APP_SOCKET_URL","SocketService","constructor","socket","listeners","Map","connect","_this$socket","connected","transports","reconnection","reconnectionDelay","reconnectionAttempts","on","console","log","error","disconnect","emit","event","data","callback","has","set","get","push","off","callbacks","index","indexOf","splice","removeAllListeners","delete","register","username","findGame","cancelSearch","createRoom","maxPlayers","joinRoom","lobbyId","ready","selectAction","action","leaveRoom"],"sources":["C:/Users/jelay/Downloads/life-sim-game/frontend/src/services/socket.js"],"sourcesContent":["// src/services/socket.js\nimport { io } from 'socket.io-client';\n\nconst SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:3001';\n\nclass SocketService {\n  constructor() {\n    this.socket = null;\n    this.listeners = new Map();\n  }\n\n  connect() {\n    if (this.socket?.connected) return;\n\n    this.socket = io(SOCKET_URL, {\n      transports: ['websocket'],\n      reconnection: true,\n      reconnectionDelay: 1000,\n      reconnectionAttempts: 5\n    });\n\n    this.socket.on('connect', () => {\n      console.log('✅ Connected to server');\n    });\n\n    this.socket.on('disconnect', () => {\n      console.log('❌ Disconnected from server');\n    });\n\n    this.socket.on('error', (error) => {\n      console.error('Socket error:', error);\n    });\n\n    return this.socket;\n  }\n\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n    }\n  }\n\n  emit(event, data) {\n    if (this.socket) {\n      this.socket.emit(event, data);\n    }\n  }\n\n  on(event, callback) {\n    if (this.socket) {\n      this.socket.on(event, callback);\n      \n      // เก็บ listener ไว้\n      if (!this.listeners.has(event)) {\n        this.listeners.set(event, []);\n      }\n      this.listeners.get(event).push(callback);\n    }\n  }\n\n  off(event, callback) {\n    if (this.socket) {\n      this.socket.off(event, callback);\n      \n      // ลบ listener\n      if (this.listeners.has(event)) {\n        const callbacks = this.listeners.get(event);\n        const index = callbacks.indexOf(callback);\n        if (index > -1) {\n          callbacks.splice(index, 1);\n        }\n      }\n    }\n  }\n\n  removeAllListeners(event) {\n    if (this.socket) {\n      this.socket.removeAllListeners(event);\n      this.listeners.delete(event);\n    }\n  }\n\n  // Game Actions\n  register(username) {\n    this.emit('register', { username });\n  }\n\n  findGame() {\n    this.emit('findGame');\n  }\n\n  cancelSearch() {\n    this.emit('cancelSearch');\n  }\n\n  createRoom(maxPlayers = 4) {\n    this.emit('createRoom', { maxPlayers });\n  }\n\n  joinRoom(lobbyId) {\n    this.emit('joinRoom', { lobbyId });\n  }\n\n  ready() {\n    this.emit('ready');\n  }\n\n  selectAction(action) {\n    this.emit('selectAction', { action });\n  }\n\n  leaveRoom() {\n    this.emit('leaveRoom');\n  }\n}\n\nexport default new SocketService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}